[id="reclaiming-postgresql-space-after-an-upgrade_{context}"]
= Reclaiming PostgreSQL Space

The PostgreSQL database can use a large amount of disk space especially in heavily loaded deployments.
Use this procedure to reclaim some of this disk space on {Project}.

.Procedure

. Stop all services, except for the `postgresql` service:
+
[options="nowrap" subs="+quotes,attributes"]
----
# {foreman-maintain} service stop --exclude postgresql
----

. Switch to the `postgres` user and reclaim space on the database:
+
[options="nowrap"]
----
# su - postgres -c 'vacuumdb --full --dbname=foreman'
----

. Start the other services when the vacuum completes:
+
[options="nowrap" subs="+quotes,attributes"]
----
# {foreman-maintain} service start
----

. Confirm files are present under `/var/lib/pgsql/` and check its size.
+
[options="nowrap" subs="+quotes,attributes"]
----
# ls -l /var/lib/pgsql/

# du -sh /var/lib/pgsq/
----

. If you are using {ProjectServer} {ProjectVersionPrevious} and higher, the data from `/var/lib/pgsql/` can be deleted.
+
[options="nowrap" subs="+quotes,attributes"]
----
# rm -rf /var/lib/pgsql/*
----
