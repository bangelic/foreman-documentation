[id="Using_Container_Registries_{context}"]
= Using container registries

Podman and Docker can be used to fetch content from container registries.

ifndef::orcharhino[]
.Container registries on {SmartProxies}

On {SmartProxies} with content, the https://github.com/Katello/smart_proxy_container_gateway[Container Gateway] {SmartProxy} plugin acts as the container registry.
It caches authentication information from Katello and proxies incoming requests to Pulp.
The Container Gateway is available by default on {SmartProxies} with content.
endif::[]

.Procedure

Logging in to the container registry:
[options="nowrap", subs="+quotes,attributes"]
----
# podman login {foreman-example-com}
----

Listing container images:
[options="nowrap", subs="+quotes,attributes"]
----
# podman search {foreman-example-com}/
----

Pulling container images:
[options="nowrap", subs="+quotes,attributes"]
----
# podman pull {foreman-example-com}/my-image:<optional_tag>
----

Containers can be pushed to {Project}'s container registry.
The {Project} registry follows the Open Containers Initiative (OCI) specification, so content can be pushed to Katello using the same methods that apply to other registries.
For more information about OCI, see https://opencontainers.org/[Open Container Initiative Distribution Specification].

To indicate which organization, product, and repository the container image belongs to, use container namespaces.
Pushes follow one of two formats:
[subs="+quotes,attributes"]
----
# podman push <image> example.com/<organization_label>/<product_label>/<repository_name>[:tag]

# podman push <image> example.com/id/<organization_id>/<product_id>/<repository_name>[:tag]
----
All labels should be composed of entirely lowercase characters regardless of actual label capitalization.
A complete push will look like the following:
[subs="+quotes,attributes"]
----
# podman push d2c94e258dcb example.com/default_organization/test_product/hello-world:latest
Getting image source signatures
Copying blob ac28800ec8bb done   |
Copying config d2c94e258d done   |
Writing manifest to image destination
----

A repository in Katello will be created once the content is pushed.
If the organization or product does not exist, Katello will send an error telling the user to ensure the proper entities are created first.
Subsequent pushes to the same repository will update the contents of that repository.
Content should be able to be pulled as soon as it is pushed.

Content may only be pushed to the {Project} itself.
If pushed content needs to be on {SmartProxies} as well, use {SmartProxy} syncing.

Podman requires that all characters in the pushed container name contain only lowercase characters.
To push content to an organization or product, a user must be able to create repositories.

Unless pushed repositories are published in a content view version, they will not follow the Registry Name Pattern.
This is to ensure that users can push and pull from the same path.

Users are required to push and pull from the same path.
If a user uses the label-based schema, they will pull using labels.
If a user uses the ID-based schema, they will pull using IDs.
